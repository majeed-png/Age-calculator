<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ù…Ø± â€“ ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ø±Ùƒ | Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø«ÙˆÙŠÙ†ÙŠ</title>
<meta name="description" content="ØªÙØ§ØµÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø¹ÙÙ…Ø±Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ: Ø³Ù†ÙˆØ§Øª ÙˆØ´Ù‡ÙˆØ± ÙˆØ£Ø³Ø§Ø¨ÙŠØ¹ ÙˆØ£ÙŠØ§Ù… ÙˆØ³Ø§Ø¹Ø§ØªØŒ Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ÙØµÙ„ ÙˆÙˆÙ‚Øª Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù… ÙˆØ­Ù‚Ø§Ø¦Ù‚ Ù…Ù…ØªØ¹Ø©.">
<meta name="keywords" content="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ø±, Ø¹Ù…Ø± Ø¨Ø§Ù„Ø§Ø´Ù‡Ø±, Ø¹Ù…Ø± Ø¨Ø§Ù„Ø§ÙŠØ§Ù…, Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù‡Ø¬Ø±ÙŠ, Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ, Ù…ØªÙ‰ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ÙŠ, ÙƒÙ… Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ÙŠ, Ø§Ø­Ø³Ø¨ Ø¹Ù…Ø±ÙŠ, Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ù…Ø±, Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰">
<meta property="og:title" content="ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ø±Ùƒ">
<meta property="og:description" content="ØªÙØ§ØµÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø¹ÙÙ…Ø±Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ + Ø­Ù‚Ø§Ø¦Ù‚ Ù…Ù…ØªØ¹Ø©.">
<style>
:root{
  --bg:#0f1115;
  --card:#151a22;
  --text:#e9eef6;
  --muted:#a8b3c7;
  --accent:#ef4444;
  --accent-2:#ef4444;
  --radius:14px;
  --shadow: 0 10px 30px rgba(0,0,0,.25);
  --font: "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Kufi Arabic", "Noto Sans Arabic", Arial, "Apple Color Emoji","Segoe UI Emoji";
}
:root[data-theme='light']{
  --bg:#e7ecf3;
  --card:#f1f4f9;
  --text:#0b0f14;
  --muted:#4b5565;
}
:root[data-theme='amoled']{
  --bg:#000000;
  --card:#0a0a0a;
  --text:#e9eef6;
  --muted:#a8b3c7;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
     radial-gradient(1200px 600px at 100% -10%, rgba(124,92,255,.10), transparent 60%),
     radial-gradient(1200px 600px at -30% 110%, rgba(46,211,198,.08), transparent 60%),
     var(--bg);
  color:var(--text);
  font-family:var(--font);
  line-height:1.7;
}
:root[data-theme='light'] body,
:root[data-theme='light']{
  background:
     radial-gradient(1200px 600px at 100% -10%, rgba(124,92,255,.06), transparent 60%),
     radial-gradient(1200px 600px at -30% 110%, rgba(46,211,198,.06), transparent 60%),
     var(--bg);
}
.container{max-width:1000px;margin:24px auto;padding:16px}
.card{
  background:var(--card);
  border:1px solid rgba(255,255,255,.06);
  border-radius: var(--radius);
  padding:18px;
  box-shadow: var(--shadow);
  margin-top:16px;
}
:root[data-theme='light'] .card{border:1px solid rgba(10,10,10,.08)}
h1{margin:0 0 8px 0;font-weight:800;letter-spacing:.2px}
h2{margin:22px 0 10px 0;font-weight:800}
h3{margin:14px 0 10px 0;font-weight:800}
a{color:var(--accent)}
label{display:block;font-weight:700;margin-bottom:6px}

input, select{
  width:100%;
  border-radius:12px;
  padding:12px 14px;
  height:52px;
  background:#0c0f14;
  color:var(--text);
  border:1px solid rgba(255,255,255,.08);
  outline:none;
  transition: box-shadow .2s, border-color .2s;
}
:root[data-theme='light'] input,
:root[data-theme='light'] select{
  background:#e9edf4;
  border:1px solid rgba(0,0,0,.10);
  color:#0b0f14;
}
input:focus, select:focus{
  box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 38%, transparent);
  border-color: var(--accent);
}

/* Accent buttons stay accent in all themes */
button{
  cursor:pointer;
  border:none;
  border-radius:12px;
  padding:12px 14px;
  height:52px;
  background:linear-gradient(135deg, var(--accent), var(--accent-2));
  color:white;
  font-weight:800;
}

/* Ghost button (copy link) adapts to theme */
.ghost-btn{
  background:#0c0f14;
  color:var(--text);
  border:1px solid rgba(255,255,255,.15);
}
:root[data-theme='light'] .ghost-btn{
  background:#eef3fa;
  color:#0b0f14;
  border:1px solid rgba(0,0,0,.12);
}

.muted{color:var(--muted)}
.notice{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px;margin-top:10px}
:root[data-theme='light'] .notice{background:#eef3fa;border:1px dashed rgba(0,0,0,.12)}
.navbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px}
.navbar .row{display:flex;gap:10px;flex-wrap:nowrap}
.badge{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);font-weight:700}
.inputs{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:end}
@media(max-width:800px){.inputs{grid-template-columns:1fr}}
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
@media(max-width:900px){.kpis{grid-template-columns:repeat(2,1fr)}}
.kpi{background:#0c0f14;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px}
:root[data-theme='light'] .kpi{background:#e9edf4;border:1px solid rgba(0,0,0,.08)}
.kpi .num{font-size:1.6rem;font-weight:900}
.tag{padding:6px 10px;border-radius:12px;background:rgba(255,255,255,.08);font-weight:700}
:root[data-theme='light'] .tag{background:#e9edf4}
footer{opacity:.7;padding:20px 6px}
.panel{display:none;margin-top:10px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.theme-btn{padding:12px 14px;border-radius:12px;background:#0c0f14;border:1px solid rgba(255,255,255,.14);cursor:pointer;color:var(--text)!important;min-width:140px;text-align:center;position:relative}
:root[data-theme='light'] .theme-btn{background:#e9edf4;border:1px solid rgba(0,0,0,.12);color:#0b0f14!important}
.theme-btn.selected{outline:3px solid var(--accent); outline-offset:3px; border-color:var(--accent)}
.color-dot{width:26px;height:26px;border-radius:50%;border:2px solid rgba(255,255,255,.5);cursor:pointer;position:relative}
:root[data-theme='light'] .color-dot{border-color:rgba(0,0,0,.35)}
.color-dot.selected::after{content:"âœ“"; position:absolute; inset:0; display:flex; align-items:center; justify-content:center;font-weight:900; color:#000; mix-blend-mode:screen}
.small-btn{min-width:56px}
.select-wrap{position:relative}
.select-wrap select{appearance:none;-webkit-appearance:none;padding-inline-start:14px;padding-inline-end:40px}
.select-wrap .caret{position:absolute; left:12px; top:50%; transform:translateY(-50%); pointer-events:none; opacity:.7}
.lang-chip{padding:8px 12px;border-radius:12px;background:#0c0f14;border:1px solid rgba(255,255,255,.14);cursor:pointer;opacity:.55}
:root[data-theme='light'] .lang-chip{background:#e9edf4;border:1px solid rgba(0,0,0,.12)}
.lang-chip.selected{outline:3px solid var(--accent); outline-offset:3px; opacity:1}
.share-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.share-btn{max-width:260px}
:root[data-theme='light'] .birthday-banner{ color:#0b0f14 !important; text-shadow:none !important; }
.copy-toast{position:fixed;bottom:22px;right:22px;background:var(--card);border:1px solid rgba(255,255,255,.14);padding:10px 14px;border-radius:12px;display:none}
.countdown{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:10px}
.count-box{min-width:110px;text-align:center;background:#0c0f14;border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:12px}
:root[data-theme='light'] .count-box{background:#e9edf4;border:1px solid rgba(0,0,0,.08)}
.count-num{font-weight:900;font-size:1.5rem}
.fact-line{margin:14px 0; font-weight:800} /* thicker facts text on page */
.ver{opacity:.6;font-weight:700}
.facts-title{font-weight:900; letter-spacing:.1px}

.bento{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
@media(max-width:1100px){.bento{grid-template-columns:1fr}}
.birthday .card, .birthday body{ 
  background: radial-gradient(1000px 600px at 0% 0%, rgba(255,215,0,.12), transparent 60%), 
              radial-gradient(1000px 600px at 100% 100%, rgba(255,105,180,.12), transparent 60%), var(--bg);
}
.birthday-banner{ display:none; background:linear-gradient(135deg, #ffd700, #ff69b4); color:#ffffff; border:0; text-align:center; padding:18px; border-radius:16px; font-weight:900; font-size:1.4rem; box-shadow:0 10px 40px rgba(0,0,0,.35), inset 0 0 60px rgba(255,255,255,.5); }
.birthday .birthday-banner{ display:block; }
:root[data-theme='light'] .birthday-banner{ color:#0b0f14 !important; text-shadow:none !important; }
.copy-toast{position:fixed;bottom:22px;right:22px;background:var(--card);border:1px solid rgba(255,255,255,.14);padding:10px 14px;border-radius:12px;display:none}
.fact-line{margin:14px 0; font-weight:800}
</style>
</head>
<body dir="rtl" lang="ar">
<div class="container">
  <div class="navbar">
    <div class="badge" data-i18n="details_badge">ğŸ¯ ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ø±Ùƒ</div>
    <div class="row">
      <button id="openCustomize" style="max-width:140px" data-i18n="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      <a href="index.html" title="Ø±Ø¬ÙˆØ¹"><button class="small-btn" style="background:#0c0f14;border:1px solid rgba(255,255,255,.15)">â¬…ï¸</button></a>
    </div>
  </div>

  
<div id="customizePanel" class="panel card" style="margin-top:8px">
  <h3 data-i18n="settings_title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
  <h4 data-i18n="background">Ø§Ù„Ø®Ù„ÙÙŠØ©</h4>
  <div class="row">
    <div class="theme-btn" data-theme="light" data-i18n="theme_light">ÙØ§ØªØ­</div>
    <div class="theme-btn" data-theme="dark" data-i18n="theme_dark">Ø¯Ø§ÙƒÙ†</div>
    <div class="theme-btn" data-theme="amoled" data-i18n="theme_amoled">Ø£Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ (AMOLED)</div>
  </div>
  <hr/>
  <h4 data-i18n="button_color">Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±</h4>
  <div class="row" id="accentRow">
    <div class="color-dot" data-accent="#6d62ff" style="background:#6d62ff"></div>
    <div class="color-dot" data-accent="#2ed3c6" style="background:#2ed3c6"></div>
    <div class="color-dot" data-accent="#f97316" style="background:#f97316"></div>
    <div class="color-dot" data-accent="#22c55e" style="background:#22c55e"></div>
    <div class="color-dot" data-accent="#06b6d4" style="background:#06b6d4"></div>
    <div class="color-dot" data-accent="#ef4444" style="background:#ef4444"></div>
  </div>
  <hr/>
  <h4 data-i18n="language">Ø§Ù„Ù„ØºØ©</h4>
  <div class="row">
    <div class="lang-chip" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
    <div class="lang-chip" data-lang="en">English</div>
  </div>
  <hr/>
  <h4 data-i18n="timezone">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</h4>
  <div class="row">
    <select id="tzSelect" style="max-width:420px"></select>
  </div>
  <div class="muted" style="margin-top:8px" data-i18n="settings_hint">Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± â€” Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø£Ø¹Ù„Ø§Ù‡. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
</div>


  <div class="card birthday-banner" data-i18n="birthday_today">Ø§Ù„ÙŠÙˆÙ… Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ! ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†Øª Ø¨Ø®ÙŠØ± ğŸ‰</div>

  <div id="contentArea" class="bento" style="display:none">
    <div class="card">
      <h2 data-i18n="metrics_title">Ø¹Ù…Ø±Ùƒ Ø¨ØµÙŠØº ÙˆØ£Ø´ÙƒØ§Ù„ Ù…Ø®ØªÙ„ÙØ©</h2>
      <div class="kpis">
        <div class="kpi"><div class="muted" data-i18n="years">Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª</div><div class="num" id="yearsAge">â€”</div></div>
        <div class="kpi"><div class="muted" data-i18n="months">Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±</div><div class="num" id="monthsAge">â€”</div></div>
        <div class="kpi"><div class="muted" data-i18n="weeks">Ø¨Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</div><div class="num" id="weeksAge">â€”</div></div>
        <div class="kpi"><div class="muted" data-i18n="days">Ø¨Ø§Ù„Ø£ÙŠØ§Ù…</div><div class="num" id="daysAge">â€”</div></div>
        <div class="kpi"><div class="muted" data-i18n="hours">Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª</div><div class="num" id="hoursAge">â€”</div></div>
      </div>

      <div class="notice" style="margin-top:12px">
        <b data-i18n="countdown_title">Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…</b>
        <div id="countdown" class="countdown" style="margin-top:8px">
          <div class="count-box"><div class="count-num" id="cdDays">â€”</div><div class="muted" data-i18n="cd_days">Ø£ÙŠØ§Ù…</div></div>
          <div class="count-box"><div class="count-num" id="cdHours">â€”</div><div class="muted" data-i18n="cd_hours">Ø³Ø§Ø¹Ø§Øª</div></div>
          <div class="count-box"><div class="count-num" id="cdMin">â€”</div><div class="muted" data-i18n="cd_minutes">Ø¯Ù‚Ø§Ø¦Ù‚</div></div>
          <div class="count-box"><div class="count-num" id="cdSec">â€”</div><div class="muted" data-i18n="cd_seconds">Ø«ÙˆØ§Ù†ÙŠ</div></div>
        </div>
      </div>

      <div class="share-row">
        <button id="shareBtn" class="share-btn" data-i18n="share_image">Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø© (Ø·ÙˆÙ„ÙŠ)</button>
        <button id="shareSquareBtn" class="share-btn" data-i18n="share_square">Ù…Ø´Ø§Ø±ÙƒØ© Ø¥Ù†Ø³ØªØ§ (Ù…Ø±Ø¨Ù‘Ø¹)</button>
        <button id="copyLinkBtn" class="share-btn" class="ghost-btn share-btn" data-i18n="copy_link">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
      </div>
      <div class="copy-toast"></div>
      <hr/>
      <h3 data-i18n="more_info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø± Ø¹Ù† Ø¹Ù…Ø±Ùƒ</h3>
      <div class="row">
        <span class="tag"><span data-i18n="born_day">ÙˆÙ„Ø¯Øª ÙŠÙˆÙ…: </span><b id="weekday">â€”</b></span>
        <span class="tag"><span data-i18n="born_season">ÙˆÙ„Ø¯Øª ÙÙŠ ÙØµÙ„: </span><b id="season">â€”</b></span>
        <span class="tag"><span data-i18n="life_stage">Ù…Ø±Ø­Ù„Ø© Ø­ÙŠØ§ØªÙƒ: </span><b id="lifeStage">â€”</b></span>
        <span class="tag" data-i18n="sleep">Ù†ÙˆÙ…Ùƒ Ø§Ù„ØµØ­ÙŠ: Ù…Ù† 7 Ø¥Ù„Ù‰ 9 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§</span>
      </div>
      <hr/>
      <h3 data-i18n="greg_age">Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</h3>
      <div id="gregInfo" class="muted">â€”</div>
      <hr/>
      <h3 data-i18n="hijri_age">Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰)</h3>
      <div id="hijriInfo" class="muted">â€”</div>
    </div>

    <div class="card">
      <h2 class="facts-title" data-i18n="facts">Ø­Ù‚Ø§Ø¦Ù‚ Ø­ØµÙ„Øª ÙÙŠ Ø­ÙŠØ§ØªÙƒ</h2>
      <div id="breathsLine" class="fact-line">â€”</div>
      <div id="heartbeatsLine" class="fact-line">â€”</div>
      <div id="laughsLine" class="fact-line">â€”</div>
      <div id="sleptLine" class="fact-line">â€”</div>
      <div id="eatenLine" class="fact-line">â€”</div>
      <div class="notice" data-i18n="clarify">
        Ù…Ø¹Ø¯Ù„Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø«Ø§Ø¨ØªØ©: Ù¢Ù  Ø£Ù„Ù Ù†ÙÙÙØ³/ÙŠÙˆÙ…ØŒ Ù¨Ù  Ù†Ø¨Ø¶Ø©/Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ù¡Ù  Ø¶Ø­ÙƒØ§Øª/ÙŠÙˆÙ…ØŒ Ù¨ Ø³Ø§Ø¹Ø§Øª Ù†ÙˆÙ…/ÙŠÙˆÙ…ØŒ Ù¨Ù  Ø¯Ù‚ÙŠÙ‚Ø© Ø·Ø¹Ø§Ù…/ÙŠÙˆÙ….
      </div>
    </div>
  </div>

  <div class="card notice" id="noData" style="display:none">
    <span data-i18n="no_birth">Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ Ø¨Ø¹Ø¯.</span>
    <a href="index.html" data-i18n="go_input">Ø§Ø°Ù‡Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</a>.
  </div>

  <footer class="container">
    ØµÙÙ†ÙØ¹ Ù„Ù€ <b>Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø«ÙˆÙŠÙ†ÙŠ</b> Â· <span class="ver">v9.8c</span> Â· ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª Â· Â© <span id="yearNow"></span>
  </footer>
</div>

<script>
const VERSION = "v9.8a";
const FONT_AR = "Tajawal, 'Noto Kufi Arabic', 'Noto Sans Arabic', system-ui, -apple-system, 'Segoe UI', sans-serif";
const FONT_EN = "system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif";
const $ = (id)=>document.getElementById(id);
const fmt = (n, lang='ar')=> Number.isFinite(n) ? n.toLocaleString(lang==='ar'?'ar-SA':'en') : 'â€”';
const QR_DATA_URL = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHwAAAB8AQAAAACDZekTAAABA0lEQVR4nK2VsW3FQAxDn4z01AZ//7G8ATUBU9hN/k/hCFF1R0CETkdRFX7EHLzFA2Cqiu6heqrqSconkHiGF4LEO44pFLtPM/Us5Vdgqk/qTynvwAiQthw4cSLfRy84yg2+Lw0bDpIkEKEkWXHYdqJYxNGOg8iRkIlW/cABGUPAy37IUoTlZPuW4CALE63qOFTRBAjAal4IMUTRvg7UisYNKrTTOtiXPrys4xKWJRLCUh8OBuOILOsAJTeJ9vq4hGbYzdwhIhfgjmflyRhILrl79y9fhKFIjzVktV+YYiROqHavPVkn3ekwy/0CTDO0mtfsfV3CoLV/ABbCWDud1j/s/W+JBsl7A5OQ/gAAAABJRU5ErkJggg==';
const NAME_AR = 'Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ù„Ø«ÙˆÙŠÙ†ÙŠ';
const NAME_EN = 'Abdulmajeed Althuwaini';

/* i18n */ 
const I18N = {
  ar: { app_badge:"âš¡ Ø¢Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø±", settings:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", settings_title:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", background:"Ø§Ù„Ø®Ù„ÙÙŠØ©",
        theme_light:"ÙØ§ØªØ­", theme_dark:"Ø¯Ø§ÙƒÙ†", theme_amoled:"Ø£Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ (AMOLED)", button_color:"Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±",
        language:"Ø§Ù„Ù„ØºØ©", timezone:"Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©",
        settings_hint:"Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± â€” Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø£Ø¹Ù„Ø§Ù‡. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.",
        input_title:"Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ", input_hint:"Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø«Ù… Ø§ÙƒØªØ¨ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©.",
        hijri_notice:"Ø§Ù„ØªØ­ÙˆÙŠÙ„ <b>Ø§Ù„Ù‡Ø¬Ø±ÙŠ</b> Ù‡Ù†Ø§ ÙˆÙÙ‚ <b>ØªÙ‚ÙˆÙŠÙ… Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰</b> Ù„Ù„ÙØªØ±Ø© 1937â€“2077 (Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ù‚Ø¨Ù„/Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚).",
        type_label:"Ù†ÙˆØ¹ Ø§Ù„ØªØ§Ø±ÙŠØ®", gregorian:"Ù…ÙŠÙ„Ø§Ø¯ÙŠ", hijri:"Ù‡Ø¬Ø±ÙŠ (Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰)",
        day:"Ø§Ù„ÙŠÙˆÙ…", month:"Ø§Ù„Ø´Ù‡Ø±", year:"Ø§Ù„Ø³Ù†Ø©", calc:"Ø§Ø­Ø³Ø¨",
        details_badge:"ğŸ¯ ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ø±Ùƒ", birthday_today:"Ø§Ù„ÙŠÙˆÙ… Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ! ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†Øª Ø¨Ø®ÙŠØ± ğŸ‰",
        metrics_title:"Ø¹Ù…Ø±Ùƒ Ø¨ØµÙŠØº ÙˆØ£Ø´ÙƒØ§Ù„ Ù…Ø®ØªÙ„ÙØ©", years:"Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª", months:"Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±", weeks:"Ø¨Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹", days:"Ø¨Ø§Ù„Ø£ÙŠØ§Ù…", hours:"Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª",
        more_info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø± Ø¹Ù† Ø¹Ù…Ø±Ùƒ", born_day:"ÙˆÙ„Ø¯Øª ÙŠÙˆÙ…: ", born_season:"ÙˆÙ„Ø¯Øª ÙÙŠ ÙØµÙ„: ", life_stage:"Ù…Ø±Ø­Ù„Ø© Ø­ÙŠØ§ØªÙƒ: ",
        sleep:"Ù†ÙˆÙ…Ùƒ Ø§Ù„ØµØ­ÙŠ: Ù…Ù† 7 Ø¥Ù„Ù‰ 9 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§", greg_age:"Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ", hijri_age:"Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰)",
        facts:"Ø­Ù‚Ø§Ø¦Ù‚ Ø­ØµÙ„Øª ÙÙŠ Ø­ÙŠØ§ØªÙƒ", breaths:"ØªÙÙ†ÙÙÙ‘ÙØ³ØªÙ Ø­ÙˆØ§Ù„ÙŠ", heartbeats:"Ù†ÙØ¨ÙØ¶Ù Ù‚Ù„Ø¨Ùƒ Ø­ÙˆØ§Ù„ÙŠ", laughs:"Ø¶ÙØ­ÙÙƒØªÙ Ø­ÙˆØ§Ù„ÙŠ", slept:"Ù†ÙÙ…ØªÙ Ø­ÙˆØ§Ù„ÙŠ", eaten:"Ø£Ù…Ø¶ÙŠØª ÙÙŠ ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø·Ø¹Ø§Ù…",
        times_word:"Ù…Ø±Ø©", beats_word:"Ù†Ø¨Ø¶Ø©",
        clarify:"Ù…Ø¹Ø¯Ù„Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø«Ø§Ø¨ØªØ©: Ù¢Ù  Ø£Ù„Ù Ù†ÙÙÙØ³/ÙŠÙˆÙ…ØŒ Ù¨Ù  Ù†Ø¨Ø¶Ø©/Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ù¡Ù  Ø¶Ø­ÙƒØ§Øª/ÙŠÙˆÙ…ØŒ Ù¨ Ø³Ø§Ø¹Ø§Øª Ù†ÙˆÙ…/ÙŠÙˆÙ…ØŒ Ù¨Ù  Ø¯Ù‚ÙŠÙ‚Ø© Ø·Ø¹Ø§Ù…/ÙŠÙˆÙ….",
        no_birth:"Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ Ø¨Ø¹Ø¯.", go_input:"Ø§Ø°Ù‡Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„",
        share_image:"Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø© (Ø·ÙˆÙ„ÙŠ)", share_square:"Ù…Ø´Ø§Ø±ÙƒØ© Ø¥Ù†Ø³ØªØ§ (Ù…Ø±Ø¨Ù‘Ø¹)", copy_link:"Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·",
        ph_year:"Ù…Ø«Ø§Ù„: 1410 Ø£Ùˆ 1998", ph_day:"Ù…Ø«Ø§Ù„: 1", ph_month:"Ù…Ø«Ø§Ù„: 1",
        copied:"ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…",
        countdown_title:"Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…",
        cd_days:"Ø£ÙŠØ§Ù…", cd_hours:"Ø³Ø§Ø¹Ø§Øª", cd_minutes:"Ø¯Ù‚Ø§Ø¦Ù‚", cd_seconds:"Ø«ÙˆØ§Ù†ÙŠ",
        site_label:"Ø§Ù„Ù…ÙˆÙ‚Ø¹: " },
  en: { app_badge:"âš¡ Age Calculator", settings:"Settings", settings_title:"Settings", background:"Background",
        theme_light:"Light", theme_dark:"Dark", theme_amoled:"Pure Black (AMOLED)", button_color:"Button Color",
        language:"Language", timezone:"Time Zone",
        settings_hint:"Background doesnâ€™t change button color â€” pick a color above. Your preferences are saved automatically.",
        input_title:"Enter Your Birthdate", input_hint:"Choose date type, then fill day, month, and year.",
        hijri_notice:"Hijri conversion uses the Umm al-Qura calendar for 1937â€“2077 (outside this range it may differ).",
        type_label:"Date type", gregorian:"Gregorian", hijri:"Hijri (Umm al-Qura)",
        day:"Day", month:"Month", year:"Year", calc:"Calculate",
        details_badge:"ğŸ¯ Your Age Details", birthday_today:"It's your birthday today! Happy Birthday ğŸ‰",
        metrics_title:"Your Age in Many Ways", years:"Years", months:"Months", weeks:"Weeks", days:"Days", hours:"Hours",
        more_info:"More about your age", born_day:"Born on: ", born_season:"Season: ", life_stage:"Life stage: ",
        sleep:"Healthy sleep: 7â€“9 hours/day", greg_age:"Age (Gregorian)", hijri_age:"Age (Hijri â€“ Umm al-Qura)",
        facts:"Facts from your life", breaths:"You breathed about", heartbeats:"Your heart beat about", laughs:"You laughed about", slept:"You slept about", eaten:"You ate",
        times_word:"times", beats_word:"times",
        clarify:"Approximate averages: 20k breaths/day, 80 bpm, 10 laughs/day, 8 h sleep/day, 80 min eating/day.",
        no_birth:"No birthdate entered yet.", go_input:"Go to input page",
        share_image:"Share as Image (Portrait)", share_square:"Share for Instagram (Square)", copy_link:"Copy Link",
        ph_year:"e.g., 1410 or 1998", ph_day:"e.g., 1", ph_month:"e.g., 1",
        copied:"Link copied âœ…",
        countdown_title:"Countdown to your next birthday",
        cd_days:"Days", cd_hours:"Hours", cd_minutes:"Min", cd_seconds:"Sec",
        site_label:"Site: " }
};

const TZ_LIST = [
 {v:'Asia/Riyadh', ar:'Ø§Ù„Ø±ÙŠØ§Ø¶ (Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©)', en:'Riyadh (KSA)'},
 {v:'Asia/Dubai', ar:'Ø¯Ø¨ÙŠ (Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª)', en:'Dubai (UAE)'},
 {v:'Africa/Cairo', ar:'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (Ù…ØµØ±)', en:'Cairo (EG)'},
 {v:'Europe/London', ar:'Ù„Ù†Ø¯Ù† (Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©)', en:'London (UK)'},
 {v:'Europe/Paris', ar:'Ø¨Ø§Ø±ÙŠØ³ (ÙØ±Ù†Ø³Ø§)', en:'Paris (FR)'},
 {v:'America/New_York', ar:'Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ (Ø£Ù…Ø±ÙŠÙƒØ§)', en:'New York (US)'},
 {v:'America/Los_Angeles', ar:'Ù„ÙˆØ³ Ø£Ù†Ø¬Ù„ÙˆØ³ (Ø£Ù…Ø±ÙŠÙƒØ§)', en:'Los Angeles (US)'},
 {v:'Asia/Tokyo', ar:'Ø·ÙˆÙƒÙŠÙˆ (Ø§Ù„ÙŠØ§Ø¨Ø§Ù†)', en:'Tokyo (JP)'},
 {v:'Asia/Istanbul', ar:'Ø¥Ø³Ø·Ù†Ø¨ÙˆÙ„ (ØªØ±ÙƒÙŠØ§)', en:'Istanbul (TR)'}
];

function tzLabel(tz, lang){
  const e = TZ_LIST.find(x=>x.v===tz);
  if(e) return lang==='ar'?e.ar:e.en;
  return tz.replaceAll('_',' ').replace('/',' â€“ ');
}

function populateTZSelect(){
  const sel = document.getElementById('tzSelect'); if(!sel) return;
  const keep = localStorage.getItem('ageTZ') || 'Asia/Riyadh';
  const lang = getLang();
  sel.innerHTML = '';
  TZ_LIST.forEach(t=>{
    const opt = document.createElement('option');
    opt.value = t.v;
    opt.textContent = (lang==='ar'?t.ar:t.en);
    if(t.v===keep) opt.selected = true;
    sel.appendChild(opt);
  });
}

function getLang(){ return localStorage.getItem('ageLang') || 'ar'; }
function setLang(l){ localStorage.setItem('ageLang', l); applyI18n(); markLang(l); populateTZSelect(); try{ if(typeof calcAndRender==='function'){ calcAndRender(); } }catch(e){} }
function markLang(l){ document.querySelectorAll('.lang-chip').forEach(e=> e.classList.toggle('selected', e.getAttribute('data-lang')===l)); }
function applyI18n(){
  const l = getLang(); const dict = I18N[l];
  document.querySelectorAll('[data-i18n]').forEach(el=>{ const k = el.getAttribute('data-i18n'); if(dict[k]) el.innerHTML = dict[k]; });
  const d = document.getElementById('day'); if(d) d.placeholder = dict.ph_day;
  const m = document.getElementById('month'); if(m) m.placeholder = dict.ph_month;
  const y = document.getElementById('year'); if(y) y.placeholder = dict.ph_year;
  const sbtn = document.getElementById('openCustomize'); if(sbtn) sbtn.textContent = dict.settings;
  document.documentElement.setAttribute('lang', l);
  document.documentElement.setAttribute('dir', l==='ar'?'rtl':'ltr');
}
function markSelectedTheme(t){ document.querySelectorAll('.theme-btn').forEach(b=>{ b.classList.toggle('selected', b.getAttribute('data-theme')===t); }); }
function markSelectedAccent(c){ document.querySelectorAll('.color-dot').forEach(d=>{ d.classList.toggle('selected', d.getAttribute('data-accent')===c); }); }
function setTheme(t){ if(!t) t='dark'; const root=document.documentElement;
  if(t==='light') root.setAttribute('data-theme','light'); else if(t==='amoled') root.setAttribute('data-theme','amoled'); else { root.setAttribute('data-theme','dark'); t='dark'; }
  localStorage.setItem('ageTheme', t); markSelectedTheme(t);
}
function setAccent(c){ document.documentElement.style.setProperty('--accent', c); document.documentElement.style.setProperty('--accent-2', c); localStorage.setItem('ageAccent', c); markSelectedAccent(c); }
function loadPrefs(){
  const t = localStorage.getItem('ageTheme') || 'dark'; const c = localStorage.getItem('ageAccent') || '#6d62ff'; const l = getLang();
  setAccent(c); setTheme(t); markLang(l); applyI18n(); populateTZSelect();
  const tz = localStorage.getItem('ageTZ') || 'Asia/Riyadh'; const tzSel=document.getElementById('tzSelect'); if(tzSel) tzSel.value = tz;
}
function setupSettings(){
  const btn=document.getElementById('openCustomize'), p=document.getElementById('customizePanel'); if(btn&&p){ btn.onclick=()=>{ p.style.display = (p.style.display==='block')?'none':'block'; window.scrollTo({top:0,behavior:'smooth'}); }; }
  document.querySelectorAll('.theme-btn').forEach(b=> b.addEventListener('click', ()=> setTheme(b.getAttribute('data-theme')) ));
  document.querySelectorAll('.color-dot').forEach(d=> d.addEventListener('click', ()=> setAccent(d.getAttribute('data-accent')) ));
  document.querySelectorAll('.lang-chip').forEach(d=> d.addEventListener('click', ()=> setLang(d.getAttribute('data-lang')) ));
  const tzSel=document.getElementById('tzSelect'); if(tzSel){ tzSel.addEventListener('change', ()=>{ localStorage.setItem('ageTZ', tzSel.value); location.reload(); }); }
  loadPrefs();
}
function nowInTZ(tz){ const f=new Intl.DateTimeFormat('en-US',{timeZone:tz, year:'numeric', month:'numeric', day:'numeric', hour:'numeric', minute:'numeric', second:'numeric', hour12:false}); const parts=f.formatToParts(new Date()); const g=t=>+parts.find(p=>p.type===t).value; return new Date(Date.UTC(g('year'),g('month')-1,g('day'),g('hour'),g('minute'),g('second'))); }
function gregToUmmAlQura(date){ const parts=new Intl.DateTimeFormat('en-u-ca-islamic-umalqura',{year:'numeric',month:'numeric',day:'numeric'}).formatToParts(date); return {year:+parts.find(p=>p.type==='year').value, month:+parts.find(p=>p.type==='month').value, day:+parts.find(p=>p.type==='day').value}; }
const ISLAMIC_EPOCH = 1948439.5;
function islamicToJDN(y,m,d){ return d + Math.ceil(29.5*(m-1)) + (y-1)*354 + Math.floor((3 + 11*y)/30) + ISLAMIC_EPOCH - 1; }
function jdnToGreg(jd){ const Z=Math.floor(jd+0.5); let A=Z; const alpha=Math.floor((A-1867216.25)/36524.25); A=A+1+alpha-Math.floor(alpha/4); const B=A+1524; const C=Math.floor((B-122.1)/365.25); const D=Math.floor(365.25*C); const E=Math.floor((B-D)/30.6001); const day=B-D-Math.floor(30.6001*E); const month=(E<14)?E-1:E-13; const year=(month>2)?C-4716:C-4715; return {year,month,day}; }
function ummAlQuraToGreg(y,m,d){ const g0=jdnToGreg(islamicToJDN(y,m,d)); const base=new Date(Date.UTC(g0.year,g0.month-1,g0.day)); const dayMs=86400000; const tryFind=(span)=>{ for(let off=-span; off<=span; off++){ const t=new Date(base.getTime()+off*dayMs); const h=gregToUmmAlQura(t); if(h.year===y && h.month===m && h.day===d){ return {year:t.getUTCFullYear(), month:t.getUTCMonth()+1, day:t.getUTCDate()}; } } return null; }; return tryFind(6) || tryFind(20) || {year:g0.year, month:g0.month, day:g0.day}; }
function ummMonthLength(y,m){ const start=ummAlQuraToGreg(y,m,1); let ny=y, nm=m+1; if(nm>12){ nm=1; ny++; } const next=ummAlQuraToGreg(ny,nm,1); const d1=Date.UTC(start.year,start.month-1,start.day); const d2=Date.UTC(next.year,next.month-1,next.day); return Math.round((d2-d1)/86400000); }

/* drawing helpers */
function roundedRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath();}
function drawQR(ctx, x, y, size){ if(!QR_DATA_URL) return; const img=new Image(); img.onload=()=>{ ctx.drawImage(img, x, y, size, size); }; img.src=QR_DATA_URL; }

/* share portraits */
function shareImagePortrait(data, lang){
  const W=1200, H=1600;
  const c=document.createElement('canvas'); c.width=W; c.height=H; const ctx=c.getContext('2d'); const accent=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#6d62ff';
  const g=ctx.createLinearGradient(0,0,W,H); g.addColorStop(0,'#0ea5e9'); g.addColorStop(1,accent); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
  ctx.globalAlpha=0.25; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(200,220,160,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.arc(W-180,H-180,220,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
  roundedRect(ctx,50,60,W-100,H-120,34); ctx.fillStyle='rgba(255,255,255,0.10)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.35)'; ctx.lineWidth=2; ctx.stroke();
  const dict=I18N[lang]; const name = (lang==='ar')?NAME_AR:NAME_EN;
  ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='900 64px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(lang==='ar'?'ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ø±Ùƒ':'Your Age Details', W/2, 150);
  ctx.font='700 36px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(name, W/2, 200);
  ctx.font='900 108px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(fmt(data.years,lang), W/2, 330);
  ctx.font='700 32px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(lang==='ar'?'Ø³Ù†Ø©':'years', W/2, 370);
  const labels=(lang==='ar'?['Ø£Ø´Ù‡Ø±','Ø£Ø³Ø§Ø¨ÙŠØ¹','Ø£ÙŠØ§Ù…','Ø³Ø§Ø¹Ø§Øª']:['Months','Weeks','Days','Hours']); const values=[fmt(data.months,lang), fmt(data.weeks,lang), fmt(data.days,lang), fmt(data.hours,lang)];
  for(let i=0;i<4;i++){ const x=100+i*((W-200)/4); const y=440; const w=(W-240)/4; const h=150; roundedRect(ctx,x,y,w,h,24); ctx.fillStyle='rgba(255,255,255,0.16)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.35)'; ctx.lineWidth=2; ctx.stroke(); ctx.fillStyle='#fff'; ctx.font='700 28px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.textAlign='center'; ctx.fillText(labels[i], x+w/2, y+48); ctx.font='900 46px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(values[i], x+w/2, y+105); }
  ctx.textAlign='center'; ctx.fillStyle='#fff'; ctx.font='700 34px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText((lang==='ar'?'Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…: ':'Next birthday: ')+data.nextStr, W/2, 640);
  const factsL=[dict.breaths,dict.heartbeats,dict.laughs,dict.slept,dict.eaten]; 
  const factsV=[fmt(data.breaths,lang)+' '+(lang==='ar'?dict.times_word:dict.times_word),
                fmt(data.heartbeats,lang)+' '+(lang==='ar'?dict.beats_word:dict.beats_word),
                fmt(data.laughs,lang)+' '+(lang==='ar'?dict.times_word:dict.times_word),
                data.sleepStr,
                data.eatStr];
  const startY=740; for(let i=0;i<5;i++){ const y=startY+i*120; roundedRect(ctx,100,y-60,W-200,100,22); ctx.fillStyle='rgba(255,255,255,0.14)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.28)'; ctx.stroke(); ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='700 28px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(factsL[i]+' '+factsV[i], W/2, y); }
  drawQR(ctx, W-180, H-220, 120);
  const urlText = dict.site_label + 'majeed-png.github.io'; ctx.font='24px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.globalAlpha=0.9; ctx.fillText(urlText, W/2, H-100);
  const u=c.toDataURL('image/png'); const a=document.createElement('a'); a.href=u; a.download='age-share.png'; document.body.appendChild(a); a.click(); a.remove();
}
function shareImageSquare(data, lang){
  const S=1080; const c=document.createElement('canvas'); c.width=S; c.height=S; const ctx=c.getContext('2d'); const accent=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#6d62ff';
  const g=ctx.createLinearGradient(0,0,S,S); g.addColorStop(0, accent); g.addColorStop(1, '#0ea5e9'); ctx.fillStyle=g; ctx.fillRect(0,0,S,S);
  ctx.globalAlpha=0.25; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(160,160,130,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.arc(S-140,S-140,160,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
  roundedRect(ctx,40,40,S-80,S-80,30); ctx.fillStyle='rgba(255,255,255,0.10)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.35)'; ctx.lineWidth=2; ctx.stroke();
  const dict=I18N[lang]; const name=(lang==='ar')?NAME_AR:NAME_EN;
  ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='900 54px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(lang==='ar'?'ØªÙØ§ØµÙŠÙ„ Ø¹Ù…Ø±Ùƒ':'Your Age Details', S/2, 118);
  ctx.font='700 30px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(name, S/2, 160);
  // smaller age number (was 120)
  ctx.font='900 112px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(fmt(data.years,lang), S/2, 252);
  ctx.font='700 26px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(lang==='ar'?'Ø³Ù†Ø©':'years', S/2, 292);
  const labels=(lang==='ar'?['Ø£Ø´Ù‡Ø±','Ø£Ø³Ø§Ø¨ÙŠØ¹','Ø£ÙŠØ§Ù…','Ø³Ø§Ø¹Ø§Øª']:['Months','Weeks','Days','Hours']); const values=[fmt(data.months,lang), fmt(data.weeks,lang), fmt(data.days,lang), fmt(data.hours,lang)];
  for(let i=0;i<4;i++){ const x=80+i*((S-160)/4); const y=320; const w=(S-200)/4; const h=118; roundedRect(ctx,x,y,w,h,20); ctx.fillStyle='rgba(255,255,255,0.16)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.35)'; ctx.lineWidth=2; ctx.stroke(); ctx.fillStyle='#fff'; ctx.font='700 24px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.textAlign='center'; ctx.fillText(labels[i], x+w/2, y+42); ctx.font='900 38px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(values[i], x+w/2, y+90); }
  ctx.textAlign='center'; ctx.fillStyle='#fff'; ctx.font='700 28px ' + (lang==='ar'?FONT_AR:FONT_EN); 
  // raise "next" line
  ctx.fillText((lang==='ar'?'Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…: ':'Next: ')+data.nextStr, S/2, 500);
  // facts with larger spacing
  const factsL=[dict.breaths,dict.heartbeats,dict.laughs,dict.slept,dict.eaten];
  const factsV=[fmt(data.breaths,lang)+' '+(lang==='ar'?dict.times_word:dict.times_word),
                fmt(data.heartbeats,lang)+' '+(lang==='ar'?dict.beats_word:dict.beats_word),
                fmt(data.laughs,lang)+' '+(lang==='ar'?dict.times_word:dict.times_word),
                data.sleepStr,
                data.eatStr];
  const startY=565; const rowH=118;
  for(let i=0;i<5;i++){ const y=startY+i*rowH; if(y > S-105) break; const pad=85; roundedRect(ctx, pad, y-52, S-2*pad, 96, 18); ctx.fillStyle='rgba(255,255,255,0.14)'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,0.28)'; ctx.stroke(); ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='700 24px ' + (lang==='ar'?FONT_AR:FONT_EN); ctx.fillText(factsL[i]+' '+factsV[i], S/2, y); }
  drawQR(ctx, S-170, S-170, 110);
  const u=c.toDataURL('image/png'); const a=document.createElement('a'); a.href=u; a.download='age-square.png'; document.body.appendChild(a); a.click(); a.remove();
}

/* share link */
function buildShareLink(b){ const base = location.href.split('/').slice(0,-1).join('/') + '/index.html'; const l=getLang(); const theme=localStorage.getItem('ageTheme')||'dark'; const acc=encodeURIComponent(localStorage.getItem('ageAccent')||'#6d62ff'); const params=new URLSearchParams({type:b.type||'greg', d:b.greg.gD, m:b.greg.gM, y:b.greg.gY, lang:l, theme, accent:acc, go:'1'}); return base + '?' + params.toString(); }
async function copyText(t){ try{ await navigator.clipboard.writeText(t); showToast(I18N[getLang()].copied); }catch(e){ alert(t); } }
function showToast(text){ const t=document.querySelector('.copy-toast'); if(!t) return; t.textContent=text; t.style.display='block'; setTimeout(()=> t.style.display='none', 1800); }


function seasonName(m, lang){ const ar={winter:'Ø§Ù„Ø´ØªØ§Ø¡',spring:'Ø§Ù„Ø±Ø¨ÙŠØ¹',summer:'Ø§Ù„ØµÙŠÙ',autumn:'Ø§Ù„Ø®Ø±ÙŠÙ'}; const en={winter:'Winter',spring:'Spring',summer:'Summer',autumn:'Autumn'}; const s=[12,1,2].includes(m)?'winter':[3,4,5].includes(m)?'spring':[6,7,8].includes(m)?'summer':'autumn'; return (lang==='ar'?ar:en)[s]; }
function weekdayName(date, lang){ const ar=['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª']; const en=['Sun','Mon','Tue','Wed','Thu','Fri','Sat']; return (lang==='ar'?ar:en)[date.getDay()]; }
function lifeStage(y, lang){ if(lang==='en'){ if(y<13)return'Childhood'; if(y<20)return'Adolescence'; if(y<36)return'Young adult'; if(y<60)return'Middle age'; return'Senior'; } else { if(y<13)return'Ø·ÙÙˆÙ„Ø©'; if(y<20)return'Ù…Ø±Ø§Ù‡Ù‚Ø©'; if(y<36)return'Ø´Ø¨Ø§Ø¨'; if(y<60)return'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ù…Ø±'; return'ÙƒØ¨ÙŠØ± Ø³Ù†'; } }

let cdTimer=null;
function startCountdown(target, tz, lang){
  if(cdTimer) clearInterval(cdTimer);
  const update=()=>{
    const now = nowInTZ(tz);
    let diff = target - now;
    if(diff < 0) diff = 0;
    const s = Math.floor(diff/1000);
    const d = Math.floor(s / 86400);
    const h = Math.floor((s % 86400)/3600);
    const m = Math.floor((s % 3600)/60);
    const sec = s % 60;
    document.getElementById('cdDays').textContent = fmt(d, lang);
    document.getElementById('cdHours').textContent = fmt(h, lang);
    document.getElementById('cdMin').textContent = fmt(m, lang);
    document.getElementById('cdSec').textContent = fmt(sec, lang);
  };
  update(); cdTimer = setInterval(update, 1000);
}

function calcAndRender(){ 
  const raw = localStorage.getItem('birthInfo');
  if(!raw) { document.getElementById('noData').style.display='block'; return; }
  const b = JSON.parse(raw);
  const gY=b.greg.gY, gM=b.greg.gM, gD=b.greg.gD;
  const lang = getLang();
  const tz = localStorage.getItem('ageTZ') || 'Asia/Riyadh';

  const birth = new Date(Date.UTC(gY, gM-1, gD));
  const nowTZ = nowInTZ(tz);
  const ageMs = nowTZ - birth;
  if(ageMs < 0) { document.getElementById('noData').style.display='block'; document.getElementById('noData').textContent = (lang==='ar'?'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„':'Birthdate is in the future'); return;}

  const dayMs = 24*60*60*1000;
  const days = Math.floor(ageMs / dayMs);
  const hours = Math.floor(ageMs / (60*60*1000));
  const years = (nowTZ.getUTCFullYear() - gY) - ( (nowTZ.getUTCMonth()+1 < gM || (nowTZ.getUTCMonth()+1 === gM && nowTZ.getUTCDate() < gD)) ? 1 : 0 );
  let months = years*12 + (nowTZ.getUTCMonth()+1) - gM;
  if(nowTZ.getUTCDate() < gD) months -= 1;
  const weeks = Math.floor(days/7);

  const weekName = weekdayName(new Date(gY, gM-1, gD), lang);
  document.getElementById('weekday').textContent = weekName;
  document.getElementById('season').textContent = seasonName(gM, lang);
  document.getElementById('lifeStage').textContent = lifeStage(years, lang);

  const nowH = gregToUmmAlQura(nowTZ);
  const birthH = gregToUmmAlQura(new Date(gY, gM-1, gD));
  let hy = nowH.year - birthH.year;
  let hm = nowH.month - birthH.month;
  let hd = nowH.day - birthH.day;
  if(hd<0){ let by = nowH.year, bm = nowH.month-1; if(bm<1){ bm=12; by--; } hd += ummMonthLength(by,bm); hm -= 1; }
  if(hm<0){ hy -= 1; hm += 12; }
  document.getElementById('hijriInfo').innerHTML = (lang==='ar'
    ? `ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: <b>${birthH.day}-${birthH.month}-${birthH.year} Ù‡Ù€</b><br>
       Ø§Ù„Ø¹Ù…Ø±: <b>${fmt(hy,lang)}</b> Ø³Ù†Ø© Ùˆ <b>${fmt(hm,lang)}</b> Ø´Ù‡Ø± Ùˆ <b>${fmt(hd,lang)}</b> ÙŠÙˆÙ… (Ø­Ø³Ø¨ Ø£Ù… Ø§Ù„Ù‚Ø±Ù‰)`
    : `Birth Hijri: <b>${birthH.day}-${birthH.month}-${birthH.year} AH</b><br>
       Age: <b>${fmt(hy,lang)}</b> years, <b>${fmt(hm,lang)}</b> months, <b>${fmt(hd,lang)}</b> days (Umm al-Qura)`);

  // Top KPIs respect selected input type
  const useHijri = (b.type === 'hijri');
  const yearsTop = useHijri ? hy : years;
  const monthsTop = useHijri ? (hy*12 + hm) : months;
  document.getElementById('yearsAge').textContent = fmt(yearsTop, lang);
  document.getElementById('monthsAge').textContent = fmt(monthsTop, lang);
  document.getElementById('weeksAge').textContent = fmt(weeks, lang);
  document.getElementById('daysAge').textContent = fmt(days, lang);
  document.getElementById('hoursAge').textContent = fmt(hours, lang);

  // Next birthday (Hijri-aware)
  let nextTarget;
  if(useHijri){
    let nHy = nowH.year;
    if(nowH.month > birthH.month || (nowH.month === birthH.month && nowH.day >= birthH.day)) nHy += 1;
    const gNext = ummAlQuraToGreg(nHy, birthH.month, birthH.day);
    nextTarget = new Date(gNext.year, gNext.month-1, gNext.day);
  } else {
    nextTarget = new Date(nowTZ.getUTCFullYear(), gM-1, gD);
    if(nextTarget < nowTZ) nextTarget = new Date(nowTZ.getUTCFullYear()+1, gM-1, gD);
  }
  const remMs = nextTarget - nowTZ;
  const rDays = Math.floor(remMs/dayMs);
  const rHours = Math.floor( (remMs - rDays*dayMs) / (60*60*1000) );
  const nextBDayName = weekdayName(nextTarget, lang);
  const nextStr = `${nextBDayName} ${nextTarget.getDate()}-${nextTarget.getMonth()+1}-${nextTarget.getFullYear()}`;
  startCountdown(nextTarget, tz, lang);

  // TZ label localized
  const tzText = tzLabel(tz, lang);

  // Gregorian info
  document.getElementById('gregInfo').innerHTML = (lang==='ar'
    ? `ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: <b>${gD}-${gM}-${gY}</b><br>
       Ø§Ù„Ø¹Ù…Ø±: <b>${fmt(years,lang)}</b> Ø³Ù†Ø© Ùˆ <b>${fmt(months%12,lang)}</b> Ø´Ù‡Ø± Ùˆ <b>${fmt((days%30),lang)}</b> ÙŠÙˆÙ…<br>
       Ø¨Ø§Ù‚ÙŠ Ù„Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…: <b>${fmt(rDays,lang)}</b> ÙŠÙˆÙ… Ùˆ <b>${fmt(rHours,lang)}</b> Ø³Ø§Ø¹Ø©<br>
       Ø³ÙŠÙƒÙˆÙ† Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯Ùƒ ÙŠÙˆÙ… <b>${nextBDayName}</b> Ø§Ù„Ù…ÙˆØ§ÙÙ‚ <b>${nextTarget.getDate()}-${nextTarget.getMonth()+1}-${nextTarget.getFullYear()}</b> (Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©: ${tzText})`
    : `Birthdate: <b>${gD}-${gM}-${gY}</b><br>
       Age: <b>${fmt(years,lang)}</b> years, <b>${fmt(months%12,lang)}</b> months, <b>${fmt((days%30),lang)}</b> days<br>
       Until next birthday: <b>${fmt(rDays,lang)}</b> days and <b>${fmt(rHours,lang)}</b> hours<br>
       Next birthday on <b>${nextBDayName}</b> <b>${nextTarget.getDate()}-${nextTarget.getMonth()+1}-${nextTarget.getFullYear()}</b> (Time Zone: ${tzText})`);

  // Facts
  const breathsPerDay = 20000, bpm = 80, laughsPerDay = 10, sleepHours = 8, eatMinutes = 80;
  const breaths = breathsPerDay * days;
  const heartbeats = Math.round(bpm*60*24 * days);
  const laughs = laughsPerDay * days;
  const toYMD = (dd)=>{ const y=Math.floor(dd/365.25); dd -= y*365.25; const mo=Math.floor(dd/30.4375); dd -= mo*30.4375; const d=Math.round(dd); return {y,mo,d}; };
  const s = toYMD((sleepHours/24) * days);
  const e = toYMD((eatMinutes/60/24) * days);

  if(lang==='ar') {
    document.getElementById('breathsLine').textContent = `ØªÙÙ†ÙÙÙ‘ÙØ³ØªÙ Ø­ÙˆØ§Ù„ÙŠ ${fmt(breaths,'ar')} Ù…Ø±Ø©`;
    document.getElementById('heartbeatsLine').textContent = `Ù†ÙØ¨ÙØ¶Ù Ù‚Ù„Ø¨Ùƒ Ø­ÙˆØ§Ù„ÙŠ ${fmt(heartbeats,'ar')} Ù†Ø¨Ø¶Ø©`;
    document.getElementById('laughsLine').textContent = `Ø¶ÙØ­ÙÙƒØªÙ Ø­ÙˆØ§Ù„ÙŠ ${fmt(laughs,'ar')} Ù…Ø±Ø©`;
    document.getElementById('sleptLine').textContent = `Ù†ÙÙ…ØªÙ Ø­ÙˆØ§Ù„ÙŠ ${fmt(s.y,'ar')} Ø³Ù†Ø© Ùˆ ${fmt(s.mo,'ar')} Ø´Ù‡Ø± Ùˆ ${fmt(s.d,'ar')} ÙŠÙˆÙ…`;
    document.getElementById('eatenLine').textContent = `Ø£Ù…Ø¶ÙŠØª ÙÙŠ ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø·Ø¹Ø§Ù… ${fmt(e.y,'ar')} Ø³Ù†Ø© Ùˆ ${fmt(e.mo,'ar')} Ø´Ù‡Ø± Ùˆ ${fmt(e.d,'ar')} ÙŠÙˆÙ…`;
  } else {
    document.getElementById('breathsLine').textContent = `You breathed about ${fmt(breaths,'en')} times`;
    document.getElementById('heartbeatsLine').textContent = `Your heart beat about ${fmt(heartbeats,'en')} times`;
    document.getElementById('laughsLine').textContent = `You laughed about ${fmt(laughs,'en')} times`;
    document.getElementById('sleptLine').textContent = `You slept about ${fmt(s.y,'en')} years, ${fmt(s.mo,'en')} months, and ${fmt(s.d,'en')} days`;
    document.getElementById('eatenLine').textContent = `You ate ${fmt(e.y,'en')} years, ${fmt(e.mo,'en')} months, and ${fmt(e.d,'en')} days`;
  }

  // Share actions â€” pick current lang at click time
  document.getElementById('shareBtn').onclick = ()=>{
    const L = getLang();
    const yearsS = useHijri ? hy : years;
    const monthsS = useHijri ? (hy*12 + hm) : months;
    shareImagePortrait({
      years: yearsS, months: monthsS, weeks, days, hours, nextStr,
      breaths, heartbeats, laughs,
      sleepStr: (L==='ar'?`${fmt(s.y,'ar')} Ø³Ù†Ø© ${fmt(s.mo,'ar')} Ø´Ù‡Ø± ${fmt(s.d,'ar')} ÙŠÙˆÙ…`
                           :`${fmt(s.y,'en')} years, ${fmt(s.mo,'en')} months, and ${fmt(s.d,'en')} days`),
      eatStr: (L==='ar'?`${fmt(e.y,'ar')} Ø³Ù†Ø© ${fmt(e.mo,'ar')} Ø´Ù‡Ø± ${fmt(e.d,'ar')} ÙŠÙˆÙ…`
                         :`${fmt(e.y,'en')} years, ${fmt(e.mo,'en')} months, and ${fmt(e.d,'en')} days`)
    }, L);
  };
  document.getElementById('shareSquareBtn').onclick = ()=>{
    const L = getLang();
    const yearsS2 = useHijri ? hy : years;
    const monthsS2 = useHijri ? (hy*12 + hm) : months;
    shareImageSquare({
      years: yearsS2, months: monthsS2, weeks, days, hours, nextStr,
      breaths, heartbeats, laughs,
      sleepStr: (L==='ar'?`${fmt(s.y,'ar')} Ø³Ù†Ø© ${fmt(s.mo,'ar')} Ø´Ù‡Ø± ${fmt(s.d,'ar')} ÙŠÙˆÙ…`
                           :`${fmt(s.y,'en')} years, ${fmt(s.mo,'en')} months, and ${fmt(s.d,'en')} days`),
      eatStr: (L==='ar'?`${fmt(e.y,'ar')} Ø³Ù†Ø© ${fmt(e.mo,'ar')} Ø´Ù‡Ø± ${fmt(e.d,'ar')} ÙŠÙˆÙ…`
                         :`${fmt(e.y,'en')} years, ${fmt(e.mo,'en')} months, and ${fmt(e.d,'en')} days`)
    }, L);
  };
  document.getElementById('copyLinkBtn').onclick = ()=>{ copyText(buildShareLink(b)); };

  document.getElementById('contentArea').style.display='grid';

  // Special birthday style (Gregorian)
  if(nowTZ.getUTCDate()===gD && (nowTZ.getUTCMonth()+1)===gM){
    document.body.classList.add('birthday');
  }
}

document.getElementById('yearNow').textContent = new Date().getFullYear();
setupSettings(); applyI18n(); calcAndRender();
</script>
</body>
</html>
